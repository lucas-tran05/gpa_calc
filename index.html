<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>GPA Calculator</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body>
    <div class="container mt-5 mb-5 p-4 border border-danger rounded shadow-sm">
        <h4 class="mb-4 text-danger">Tính điểm tổng kết môn học</h4>

        <div class="row mb-3">
            <div class="col-md-6">
                <label for="structureSelect" class="form-label fw-bold">Chọn cấu trúc điểm (%)</label>
                <select id="structureSelect" class="form-select" onchange="renderScoreInputs()">
                    <option value="10-20-20-50">10-20-20-50</option>
                    <option value="10-10-20-60">10-10-20-60</option>
                    <option value="10-20-70">10-20-70</option>
                    <option value="10-30-60">10-30-60</option>
                    <option value="20-30-50">20-30-50</option>
                    <option value="20-20-60">20-20-60</option>
                </select>
            </div>
        </div>

        <div class="row mb-3">
            <div class="col">
                <label class="form-label fw-bold">Nhập điểm thành phần</label>
                <div id="scoreInputs" class="d-flex flex-wrap gap-2"></div>
            </div>
        </div>

        <button class="btn btn-danger fw-bold" onclick="calculateFinalScore()">Tính điểm tổng kết</button>
        <p id="finalResult" class="fw-bold text-success mt-3"></p>
    </div>

    <div class="container mt-5">
        <h3 class="mb-4 ">GPA Calculator</h3>
        <div class="mb-3">
            <button class="btn btn-outline-success" onclick="addCourse()">Thêm môn học</button>
        </div>
        <table class="table table-bordered align-middle" id="coursesTable">
            <thead class="table-light">
                <tr>
                    <th>Tên môn học</th>
                    <th>Số tín chỉ</th>
                    <th>Điểm hệ chữ</th>
                    <th>Hành động</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
        <div class="mt-3">
            <button class="btn btn-outline-primary" onclick="calculateGPA()">Tính GPA</button>
        </div>
        <p id="result" class="mt-4 fw-bold text-success"></p>
    </div>

    <script>
        let courses = [];

        function addCourse() {
            const tableBody = document.getElementById('coursesTable').getElementsByTagName('tbody')[0];
            const row = tableBody.insertRow();
            row.innerHTML = `
                <td><input type="text" class="form-control subject" placeholder="VD: Lập trình C++"></td>
                <td><input type="number" class="form-control credits" min="1" placeholder="Tín chỉ"></td>
                <td>
                    <select class="form-select grades">
                        <option value="A+">A+</option>
                        <option value="A">A</option>
                        <option value="B+">B+</option>
                        <option value="B">B</option>
                        <option value="C+">C+</option>
                        <option value="C">C</option>
                        <option value="D+">D+</option>
                        <option value="D">D</option>
                        <option value="F">F</option>
                    </select>
                </td>
                <td><button class="btn btn-outline-danger btn-sm" onclick="this.closest('tr').remove()">Xóa</button></td>
            `;
        }

        function gradeToGPA(grade) {
            // Quy đổi điểm chữ sang hệ 4 theo chuẩn Học viện CNTT TP.HCM
            const gpaScale = { 'A+': 4.0, 'A': 3.7, 'B+': 3.5, 'B': 3.0, 'C+': 2.5, 'C': 2.0, 'D+': 1.5, 'D': 1.0, 'F': 0 };
            return gpaScale[grade] || 0;
        }

        function calculateGPA() {
            const rows = document.getElementById('coursesTable').getElementsByTagName('tbody')[0].getElementsByTagName('tr');
            const courses = [];

            for (let i = 0; i < rows.length; i++) {
                const subject = rows[i].querySelector('.subject').value || 'Unnamed';
                const credits = parseInt(rows[i].querySelector('.credits').value) || 0;
                const grade = rows[i].querySelector('.grades').value;
                if (credits > 0) {
                    courses.push({ subject, credits, grade });
                }
            }

            let totalCredits = 0;
            let weightedGPA = 0;

            courses.forEach(course => {
                const gpa = gradeToGPA(course.grade); // Chuyển điểm chữ → GPA thang 4
                totalCredits += course.credits;
                weightedGPA += gpa * course.credits;
            });

            const gpa = totalCredits > 0 ? (weightedGPA / totalCredits) : 0;

            // Hiển thị GPA và tổng tín chỉ
            document.getElementById('result').innerText =
                `GPA (thang 4.0): ${gpa.toFixed(2)}\nSố tín chỉ tích lũy: ${totalCredits}`;
        }


        function renderScoreInputs() {
            const structure = document.getElementById("structureSelect").value.split("-").map(Number);
            const scoreInputsContainer = document.getElementById("scoreInputs");
            scoreInputsContainer.innerHTML = "";

            structure.forEach((percent, index) => {
                const input = document.createElement("input");
                input.type = "number";
                input.style.width = "20%";
                input.className = "form-control";
                input.placeholder = `Điểm ${percent}%`;
                input.setAttribute("data-weight", percent);
                scoreInputsContainer.appendChild(input);
            });
        }

        function calculateFinalScore() {
            const inputs = document.querySelectorAll("#scoreInputs input");
            let total = 0, totalWeight = 0;

            inputs.forEach(input => {
                const weight = parseFloat(input.getAttribute("data-weight"));
                const score = parseFloat(input.value) || 0;
                total += (weight / 100) * score;
                totalWeight += weight;
            });

            if (totalWeight !== 100) {
                document.getElementById("finalResult").innerText = "Tổng trọng số không phải 100%. Vui lòng kiểm tra lại!";
                return;
            }

            // Quy đổi điểm tổng kết sang điểm chữ theo chuẩn Học viện CNTT TP.HCM
            const grade = convertToLetterGrade(total);
            document.getElementById("finalResult").innerText = `Điểm tổng kết: ${total.toFixed(2)} (${grade})`;
        }

        // Hàm quy đổi điểm theo chuẩn Học viện CNTT TP.HCM
        function convertToLetterGrade(score) {
            const rounded = Math.round(score * 10) / 10;
            if (rounded >= 9.0) return 'A+';
            if (rounded >= 8.5) return 'A';
            if (rounded >= 8.0) return 'B+';
            if (rounded >= 7.0) return 'B';
            if (rounded >= 6.5) return 'C+';
            if (rounded >= 5.5) return 'C';
            if (rounded >= 5.0) return 'D+';
            if (rounded >= 4.0) return 'D';
            return 'F';
        }

        renderScoreInputs();
    </script>
</body>

</html>